
(function(global,galleryDOM){var gallery;function Galleriom(appbox){this.appbox=appbox||0;this.appView=0;this.galleryHolder=0;this.galleryCollection=[];this.gadget={thumbsView:false,caption:false,preview:false};this.leftNav=0;this.rightNav=0;this.dimensions={w:0,h:0,quantity:-1};this.tools={iClick:0,IE:false,metrics:{w:'px',h:'px'}};this.swipe={startX:0,treshold:0,left:0,divider:0,lmb:false};};Galleriom.prototype.startApp=function(env){var self=this;self.addListeners('load',env,function(){self.initialize(self);self.addListeners('resize',env,function(){var i=0,length;length=self.dimensions.quantity+1;self.setAppFrame();self.elAdjuster(self.appView,self.dimensions);self.elAdjuster(self.galleryHolder,{w:self.dimensions.w*length,h:self.dimensions.h});for(;i<length;++i){self.elAdjuster(self.galleryCollection[i],self.dimensions);}});});};Galleriom.prototype.initialize=function(self){try{self.detectImages(self.appbox.getElementsByTagName('img'));self.detectIEBrowser();self.setAppFrame();self.createView();self.createNavigation();self.createThumbsView();self.setTreshold(self.dimensions.w);self.setLeftRect(document.getElementById('galleriom-viewbox'));self.setScreenDivider(self.dimensions.w);self.addListeners('click',self.leftNav,function(evt){self.moveLeft(evt);});self.addListeners('click',self.rightNav,function(evt){self.moveRight(evt);});self.addListeners('touchstart',self.galleryHolder,function(evt){self.swipeTouchStart(evt);});self.addListeners('touchmove',self.galleryHolder,function(evt){self.swipeTouchMove(evt);});self.addListeners('touchend',self.galleryHolder,function(evt){self.swipeTouchEnd(evt);});self.addListeners('mousedown',self.galleryHolder,function(evt){self.swipeMouseStart(evt);});self.addListeners('mousemove',self.galleryHolder,function(evt){self.swipeMouseMove(evt);});self.addListeners('mouseup',self.galleryHolder,function(evt){self.swipeMouseEnd(evt);});}catch(error){console.log(error);}};Galleriom.prototype.getWidth=function(el){var w=el.offsetWidth;if(w>0){return parseInt(w);}
return 0;};Galleriom.prototype.getHeight=function(el){var h=el.offsetHeight;if(h>0){return parseInt(h);}
return 0;};Galleriom.prototype.getSizeNavBar=function(id){return document.getElementById(id).offsetWidth;};Galleriom.prototype.getDeltaX=function(startX,momentX,position,width){if(!position||!width){position=0;width=0;return startX-momentX;}
return(startX-momentX+(position*width));};Galleriom.prototype.getMaxMove=function(width,quantity,treshold,percentage){return(width*quantity+(treshold*percentage));};Galleriom.prototype.getMinMove=function(treshold,percentage){return(treshold*percentage*(-1));};Galleriom.prototype.getNavArea=function(divider,treshold){return(divider-treshold);};Galleriom.prototype.getPointerDistance=function(treshold,dist){return(treshold/dist);};Galleriom.prototype.setAppFrame=function(){this.appbox.getAttribute('data-width');this.appbox.getAttribute('data-height');this.grabber(this.appbox);this.dimensions.w=this.getWidth(this.appbox);this.dimensions.h=this.getHeight(this.appbox);};Galleriom.prototype.setWidth=function(el,widthOffset){if(typeof widthOffset==='undefined'){widthOffset=0;}
if(widthOffset===0){el.style.width='auto';}
else{el.style.width=widthOffset+this.tools.metrics.w;}};Galleriom.prototype.setHeight=function(el,heightOffset){if(typeof heightOffset==='undefined'){heightOffset=0;}
if(heightOffset===0){el.style.height='auto'}
else{el.style.height=heightOffset+this.tools.metrics.h;}};Galleriom.prototype.setClassAttr=function(el,className){el.className=className;};Galleriom.prototype.setTreshold=function(w){this.swipe.treshold=((w-this.getSizeNavBar('galleriom-left-nav')+this.getSizeNavBar('galleriom-right-nav'))/2);};Galleriom.prototype.setLeftRect=function(el){this.swipe.left=el.getBoundingClientRect().left;};Galleriom.prototype.setScreenDivider=function(w){this.swipe.divider=this.swipe.left+(w/2);};Galleriom.prototype.createImages=function(sizes){if(typeof sizes==='undefined'){sizes=0;}
var i=0,length;this.galleryCollection=document.querySelectorAll('#galleriom-jsgallery-app img');length=this.galleryCollection.length;for(;i<length;++i){this.elAdjuster(this.galleryCollection[i],sizes);this.setClassAttr(this.galleryCollection[i],'galleriom-img');if(!this.gadget.preview)this.addListeners('click',this.galleryCollection[i].parentNode,function(evt){evt.preventDefault();});this.dimensions.quantity++;}};Galleriom.prototype.createView=function(){var tmp=this.appbox.children;this.appView=document.createElement('div');this.galleryHolder=document.createElement('div');this.setAttributes(this.appView,{'id':'galleriom-viewbox','class':'galleriom-viewbox','style':'width: '+this.dimensions.w+this.tools.metrics.w+';'});this.setAttributes(this.galleryHolder,{'id':'galleriom-holder','style':'width: '+(this.dimensions.w*tmp.length)+this.tools.metrics.w+';'});this.createImages(this.dimensions);this.multipleAppend(this.galleryHolder,tmp);this.appView.appendChild(this.galleryHolder);this.appbox.appendChild(this.appView);};Galleriom.prototype.createNavigation=function(){var tmp={};tmp.left=document.createElement('div');tmp.right=document.createElement('div');tmp.left.appendChild(document.createElement('i'));tmp.right.appendChild(document.createElement('i'));if(!this.tools.IE){this.setAttributes(tmp.left,{'id':'galleriom-left-nav','class':'galleriom-gallery-nav left-nav disabled'});this.setAttributes(tmp.right,{'id':'galleriom-right-nav','class':'galleriom-gallery-nav right-nav'});}else{this.setAttributes(tmp.left,{'id':'galleriom-left-nav','class':'galleriom-gallery-nav-ie left-nav-ie disabled'});this.setAttributes(tmp.right,{'id':'galleriom-right-nav','class':'galleriom-gallery-nav-ie right-nav-ie'});}
this.leftNav=tmp.left;this.rightNav=tmp.right;this.appbox.children[0].appendChild(this.leftNav);this.appbox.children[0].appendChild(this.rightNav);this.recalcPosition(this.tools.iClick);};Galleriom.prototype.createThumbsView=function(){var that,thumbsHolder,thumb;that=this;thumbsHolder=document.createElement('div');if(this.tools.IE){thumbsHolder.className='galleriom-thumbs-view-ie';}
else{thumbsHolder.className='galleriom-thumbs-view';}
if(this.gadget.thumbsView){var elems=this.galleryHolder.children;for(var value in elems){if(elems.hasOwnProperty(value)&&!isNaN(parseInt(value))){var link,image;image=document.createElement('img');thumb=document.createElement('div');if(elems[value].nodeName==='A'){link=elems[value].getAttribute('href');}
else{link=this.galleryCollection[parseInt(value)].getAttribute('src');}
this.setAttributes(image,{'src':link,'alt':'Thumb-no.'+value,'data-no':value});if(elems[value]===elems[0]){image.className='selected-thumb';}}
this.addListeners('click',thumb,function(evt){that.thumbsToView(evt);});thumb.className='galleriom-thumbs';thumb.appendChild(image);thumbsHolder.appendChild(thumb);}}else{for(var i=0,n=this.dimensions.quantity+1;i<n;++i){thumb=document.createElement('div');this.setAttributes(thumb,{'class':'galleriom-thumbs-dotts','data-no':i});this.addListeners('click',thumb,function(evt){that.thumbsToView(evt);});thumbsHolder.appendChild(thumb);}}
this.appbox.appendChild(thumbsHolder);this.appbox.style.height='auto';};Galleriom.prototype.moveLeft=function(){this.tools.iClick--;this.recalcPosition(this.tools.iClick);};Galleriom.prototype.moveRight=function(){this.tools.iClick++;this.recalcPosition(this.tools.iClick);};Galleriom.prototype.thumbsToView=function(evt){var position;position=+evt.target.dataset['no'];this.recalcPosition(position);};Galleriom.prototype.swipeTouchStart=function(evt){evt.preventDefault();this.swipe.startX=evt.changedTouches[0].pageX;};Galleriom.prototype.swipeTouchMove=function(evt){evt.preventDefault();var el,touchobj,deltaX,maxMove,minMove;el=this.galleryHolder;touchobj=evt.changedTouches[0];deltaX=this.getDeltaX(this.swipe.startX,touchobj.pageX,this.tools.iClick,this.dimensions.w);maxMove=this.getMaxMove(this.dimensions.w,this.dimensions.quantity,this.swipe.treshold,0.5);minMove=this.getMinMove(this.swipe.treshold,0.5);if(deltaX>minMove&&deltaX<maxMove){el.style.transition='none';el.style.marginLeft=(deltaX)*(-1)+'px';}};Galleriom.prototype.swipeTouchEnd=function(evt){evt.preventDefault();var touchobj,deltaX,navArea,touchDist;touchobj=evt.changedTouches[0];deltaX=this.getDeltaX(this.swipe.startX,touchobj.pageX);navArea=this.getNavArea(this.swipe.divider,this.swipe.treshold);touchDist=this.getPointerDistance(this.swipe.treshold,2);if(!deltaX){return false;}
this.recalcPosition(this.tools.iClick);this.positionControl(deltaX,touchDist,touchobj.pageX,navArea);};Galleriom.prototype.swipeMouseStart=function(evt){evt.preventDefault();this.swipe.startX=evt.pageX;if(evt.which===1){this.swipe.lmb=true;}};Galleriom.prototype.swipeMouseMove=function(evt){evt.preventDefault();var el,deltaX,maxMove,minMove;el=this.galleryHolder;deltaX=this.getDeltaX(this.swipe.startX,evt.pageX,this.tools.iClick,this.dimensions.w);maxMove=this.getMaxMove(this.dimensions.w,this.dimensions.quantity,this.swipe.treshold,0.5);minMove=this.getMinMove(this.swipe.treshold,0.5);if(evt.which===1&&this.swipe.lmb){el.style.transition='none';if(deltaX>minMove&&deltaX<maxMove){el.style.marginLeft=(deltaX)*(-1)+'px';}}};Galleriom.prototype.swipeMouseEnd=function(evt){evt.preventDefault();var deltaX,navArea,mouseDist;deltaX=this.getDeltaX(this.swipe.startX,evt.pageX);navArea=this.getNavArea(this.swipe.divider,this.swipe.treshold);mouseDist=this.getPointerDistance(this.swipe.treshold,2);this.swipe.lmb=false;if(!deltaX){ return false;}
this.recalcPosition(this.tools.iClick);this.positionControl(deltaX,mouseDist,evt.pageX,navArea);};Galleriom.prototype.positionControl=function(deltaX,evtDist,positionX,navArea){if(!this.tools.iClick&&this.tools.iClick===this.dimensions.quantity){}else if(!this.tools.iClick){if(deltaX>=evtDist&&positionX>navArea&&positionX<=this.swipe.divider){this.moveRight();}}else if(this.tools.iClick==this.dimensions.quantity){if(deltaX<evtDist&&positionX>=navArea&&positionX>this.swipe.divider){this.moveLeft();}}else{if(deltaX<evtDist&&positionX>=navArea&&positionX>this.swipe.divider){ this.moveLeft();}
else{this.moveRight();}}};Galleriom.prototype.recalcPosition=function(position){if(position===0&&position===this.dimensions.quantity){if(!this.tools.IE){this.leftNav.className='galleriom-gallery-nav left-nav disabled';this.rightNav.className='galleriom-gallery-nav right-nav disabled';}else{this.leftNav.className='galleriom-gallery-nav-ie left-nav-ie disabled';this.rightNav.className='galleriom-gallery-nav-ie right-nav-ie disabled';}}else if(position==0){this.tools.iClick=0;if(!this.tools.IE){this.leftNav.className='galleriom-gallery-nav left-nav disabled';}
else{this.leftNav.className='galleriom-gallery-nav-ie left-nav-ie disabled';}
if(!this.tools.IE){this.rightNav.className='galleriom-gallery-nav right-nav';}
else{this.rightNav.className='galleriom-gallery-nav-ie right-nav-ie';}}else if(position===this.dimensions.quantity){this.tools.iClick=this.dimensions.quantity;if(!this.tools.IE){this.rightNav.className='galleriom-gallery-nav right-nav disabled';}
else{this.rightNav.className='galleriom-gallery-nav-ie right-nav-ie disabled';}
if(!this.tools.IE){this.leftNav.className='galleriom-gallery-nav left-nav';}
else{this.leftNav.className='galleriom-gallery-nav-ie left-nav-ie';}}else{this.tools.iClick=position;if(!this.tools.IE){this.leftNav.className='galleriom-gallery-nav left-nav';}
else{this.leftNav.className='galleriom-gallery-nav-ie left-nav-ie';}
if(!this.tools.IE){this.rightNav.className='galleriom-gallery-nav right-nav';}
else{this.rightNav.className='galleriom-gallery-nav-ie right-nav-ie';}}
this.displayImage(position);this.markThumb(position);};Galleriom.prototype.displayImage=function(position){this.galleryHolder.style.WebkitTransition='margin-left .4s ease';this.galleryHolder.style.transition='margin-left .4s ease';this.galleryHolder.style.marginLeft=(this.dimensions.w*(-1)*position)+'px';};Galleriom.prototype.markThumb=function(position){var markedEl=document.querySelector('.selected-thumb'),elToMark=document.querySelectorAll('.galleriom-thumbs-view img');if(markedEl){markedEl.className='';}
if(elToMark[position]){elToMark[position].className='selected-thumb';}};Galleriom.prototype.grabber=function(el){var attrs;attrs=el.attributes;if(attrs['data-width']){if(attrs['data-width'].value.indexOf('%')>=0){el.style.width=attrs['data-width'].value;}
else{el.style.width=attrs['data-width'].value+'px';}}
if(attrs['data-height']){if(attrs['data-height'].value.indexOf('%')>=0){el.style.height=attrs['data-height'].value;}
else{el.style.height=attrs['data-height'].value+'px';}}
if(attrs['data-thumbs']){this.gadget.thumbsView=true;}
if(attrs['data-caption']){this.gadget.caption=true;}
if(attrs['data-preview']){this.gadget.preview=true;}};Galleriom.prototype.elAdjuster=function(el,size){this.setWidth(el,size.w);this.setHeight(el,size.h);};Galleriom.prototype.setAttributes=function(el,attrs){for(var property in attrs){el.setAttribute(property,attrs[property]);}};Galleriom.prototype.multipleAppend=function(el,collection){for(var i=0,n=collection.length;i<n;++i){el.appendChild(collection[0]);}};Galleriom.prototype.addListeners=function(evnt,el,func){if(el.addEventListener){el.addEventListener(evnt,func,false);}else if(el.attachEvent){el.attachEvent('on'+evnt,func);}};Galleriom.prototype.detectIEBrowser=function(){var el=document.createElement('div');el.innerHTML='<!--[if lte IE9]> <i></i> <![endif]-->';if(el.getElementsByTagName('i')[0]){this.tools.IE=true;}};Galleriom.prototype.detectImages=function(el){if(!el.length){throw new Error('Missing images');}};gallery=function(galleryDOM){return new Galleriom(galleryDOM);};global.galleriom=gallery(galleryDOM);global.galleriom.startApp(global);})(window,document.getElementById('galleriom-jsgallery-app'));